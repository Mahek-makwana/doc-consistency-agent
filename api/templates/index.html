<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CraftAI DocSync | Enterprise Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #050505;
            color: #fff;
            margin: 0;
            overflow: hidden;
        }

        .flex-h-screen {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: #050505;
            border-right: 1px solid rgba(168, 85, 247, 0.15);
            display: flex;
            flex-direction: column;
        }

        .main-container {
            flex: 1;
            overflow-y: auto;
            position: relative;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 24px;
        }

        .btn-nav {
            cursor: pointer;
            transition: 0.3s;
            color: #666;
        }

        .btn-nav.active {
            background: linear-gradient(to right, #6366f1, #a855f7);
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        .view-section {
            display: none;
        }

        .view-section.active {
            display: block;
        }

        .btn-gradient {
            background: linear-gradient(to right, #6366f1, #a855f7);
            cursor: pointer;
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>

<body>

    <div class="flex-h-screen">
        <div class="sidebar">
            <div class="p-8 border-b border-white/5">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center shadow-lg shadow-indigo-500/50">
                        <i data-lucide="sparkles" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <h1 class="font-black text-sm uppercase tracking-tighter">CraftAI</h1>
                        <p class="text-[8px] text-indigo-400 font-black uppercase">DocSync Agent</p>
                    </div>
                </div>
            </div>
            <nav class="flex-1 p-6 space-y-2">
                <div id="nav-dashboard" onclick="showView('dashboard')"
                    class="btn-nav active flex items-center gap-4 px-5 py-4 rounded-xl"><i
                        data-lucide="layout-dashboard" class="w-5 h-5"></i><span
                        class="font-bold text-sm text-white">Dashboard</span></div>
                <div id="nav-reports" onclick="showView('reports')"
                    class="btn-nav flex items-center gap-4 px-5 py-4 rounded-xl"><i data-lucide="file-text"
                        class="w-5 h-5"></i><span class="font-bold text-sm">Reports</span></div>
                <div id="nav-history" onclick="showView('history')"
                    class="btn-nav flex items-center gap-4 px-5 py-4 rounded-xl"><i data-lucide="clock"
                        class="w-5 h-5"></i><span class="font-bold text-sm">History</span></div>
            </nav>
        </div>

        <div class="main-container scrollbar-hide">
            <div id="view-dashboard" class="view-section active p-12">
                <h1 class="text-7xl font-black mb-10 tracking-tighter">CraftAI <span
                        class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400">DocSync
                        Dashboard</span></h1>

                <form action="/analyze" method="POST" enctype="multipart/form-data" class="mb-14">
                    <div class="grid grid-cols-2 gap-6 mb-8">
                        <div class="p-10 border-2 border-dashed border-white/10 rounded-3xl text-center bg-white/[0.02] cursor-pointer hover:border-indigo-500/50 transition-all"
                            onclick="document.getElementById('code_file').click()">
                            <i data-lucide="package" class="w-10 h-10 mx-auto mb-4 text-indigo-400"></i>
                            <h3 class="text-xs font-black uppercase text-white mb-2">1. Project Scenario</h3>
                            <p id="code_txt" class="text-[10px] text-gray-500 font-bold">{% if result.code_filename %}✓
                                {{ result.code_filename }}{% else %}PY, JS, JAVA, ZIP, etc...{% endif %}</p>
                            <input type="file" id="code_file" name="code_file" class="hidden"
                                onchange="updateUI('code')">
                        </div>
                        <div class="p-10 border-2 border-dashed border-white/10 rounded-3xl text-center bg-white/[0.02] cursor-pointer hover:border-purple-500/50 transition-all"
                            onclick="document.getElementById('doc_file').click()">
                            <i data-lucide="book-open" class="w-10 h-10 mx-auto mb-4 text-purple-400"></i>
                            <h3 class="text-xs font-black uppercase text-white mb-2">2. Documentation (optional)</h3>
                            <p id="doc_txt" class="text-[10px] text-gray-500 font-bold">{% if result.doc_filename %}✓ {{
                                result.doc_filename }}{% else %}MD, TXT, RST...{% endif %}</p>
                            <input type="file" id="doc_file" name="doc_file" class="hidden" onchange="updateUI('doc')">
                        </div>
                    </div>
                    <button type="submit"
                        class="btn-gradient px-12 py-5 rounded-2xl font-black text-sm flex items-center gap-3">
                        <i data-lucide="play" class="w-5 h-5"></i> INITIATE CONSISTENCY AUDIT
                    </button>
                </form>

                {% if result and result.score is defined %}
                <div class="grid grid-cols-4 gap-6">
                    <div class="glass-card">
                        <h3 class="text-[10px] font-black uppercase text-gray-500 tracking-widest mb-4">Analysis Summary
                        </h3>
                        <p class="text-5xl font-black text-white mb-1">{{ result.score }}%</p>
                        <p class="text-[10px] text-indigo-400 font-bold uppercase">{{ result.label }}</p>
                        <p class="text-[9px] text-gray-500 mt-4 leading-relaxed">{{ result.summary }}</p>
                    </div>
                    <div class="glass-card">
                        <h3 class="text-[10px] font-black uppercase text-gray-500 tracking-widest mb-6">Statistic Report
                        </h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center"><span
                                    class="text-[11px] font-black uppercase">Total Issues</span><span
                                    class="text-2xl font-black text-red-500">{{ result.stats.total_issues }}</span>
                            </div>
                            <div class="flex justify-between items-center"><span
                                    class="text-[11px] font-black uppercase">Synced</span><span
                                    class="text-2xl font-black text-green-500">{{ result.stats.synced_terms }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card col-span-1">
                        <h3 class="text-[10px] font-black uppercase text-gray-500 tracking-widest mb-4">Issue Summary
                        </h3>
                        <p class="text-[10px] text-gray-300 leading-relaxed font-bold">{{ result.detailed_issue }}</p>
                        <div class="mt-4 h-1.5 w-full bg-white/5 rounded-full overflow-hidden">
                            <div class="h-full bg-red-500" style="width:{{ result.stats.breakdown.Terminology }}%">
                            </div>
                        </div>
                    </div>
                    <div class="glass-card">
                        <h3 class="text-[10px] font-black uppercase text-gray-500 tracking-widest mb-4">Visual Summary
                        </h3>
                        <div class="h-32 flex justify-center"><canvas id="mainChart"></canvas></div>
                        <div class="mt-4 flex justify-center gap-4 text-[8px] font-black uppercase">
                            <span class="text-indigo-400 underline decoration-indigo-500/30">● Synced</span>
                            <span class="text-pink-400 underline decoration-pink-500/30">● Gaps</span>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

            <div id="view-reports" class="view-section p-12">
                <h1 class="text-7xl font-black mb-10 tracking-tighter">Detailed <span
                        class="text-purple-400">Reports</span></h1>
                <div class="glass-card p-12 overflow-hidden border-0 bg-white/[0.02]">
                    <table class="w-full text-left">
                        <thead class="text-[10px] font-black uppercase text-gray-500 border-b border-white/5">
                            <tr>
                                <th class="pb-8">Project Name</th>
                                <th class="pb-8 text-center">Consistency</th>
                                <th class="pb-8">Status</th>
                                <th class="pb-8 text-right">Action</th>
                            </tr>
                        </thead>
                        <tbody id="report-body" class="text-sm"></tbody>
                    </table>
                </div>
            </div>

            <div id="view-history" class="view-section p-12">
                <h1 class="text-7xl font-black mb-10 tracking-tighter">Audit <span
                        class="text-indigo-400">History</span></h1>
                <div id="history-container" class="space-y-6"></div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        function saveToStorage() {
            {% if result %}
            const data = {
                project: "{{ result.code_filename[:30] if result.code_filename else 'Project Archive' }}",
                score: {{ result.score }
        },
        status: "{{ result.label }}",
            time: new Date().toLocaleString()
            };
        let h = JSON.parse(localStorage.getItem('audits_v2') || '[]');
        h.unshift(data);
        localStorage.setItem('audits_v2', JSON.stringify(h.slice(0, 10)));
        {% endif %}
        }

        function renderData() {
            const h = JSON.parse(localStorage.getItem('audits_v2') || '[]');
            const historyList = document.getElementById('history-container');
            const reportTable = document.getElementById('report-body');

            if (historyList) {
                historyList.innerHTML = h.map(e => `
                    <div class="glass-card flex justify-between items-center p-8 border-l-4 border-indigo-500 hover:bg-white/5 transition-all">
                        <div class="flex items-center gap-8">
                            <div class="w-12 h-12 bg-indigo-500/10 rounded-xl flex items-center justify-center text-indigo-400 font-black text-xs">#</div>
                            <div><h3 class="text-lg font-black uppercase text-white">${e.project}</h3><p class="text-[10px] text-gray-500 font-bold uppercase tracking-widest">${e.time}</p></div>
                        </div>
                        <div class="text-right"><p class="text-3xl font-black text-indigo-400">${e.score}%</p><p class="text-[9px] text-gray-500 font-black uppercase">Sync Result</p></div>
                    </div>
                `).join('');
            }

            if (reportTable) {
                reportTable.innerHTML = h.map(e => `
                    <tr class="border-b border-white/5 group hover:bg-white/[0.01]">
                        <td class="py-7 font-black text-gray-300 uppercase truncate max-w-[300px]">${e.project}</td>
                        <td class="py-7 text-center font-black text-indigo-400 text-lg">${e.score}%</td>
                        <td class="py-7 text-[10px] uppercase font-black text-gray-500 tracking-widest">${e.status}</td>
                        <td class="py-7 text-right"><button onclick="downloadAudit('${e.project}', ${e.score})" class="text-indigo-400 font-black hover:text-white transition-all uppercase text-[10px] tracking-widest">Download Report</button></td>
                    </tr>
                `).join('');
            }
        }

        function downloadAudit(project, score) {
            const doc = `CRAFT AI AUDIT REPORT\nPROJECT: ${project}\nCONSISTENCY: ${score}%\nVERSION: Enterprise 1.0\nGEN: ${new Date().toLocaleString()}`;
            const blob = new Blob([doc], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = `Report_${project}.txt`;
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
        }

        function showView(v) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.getElementById('view-' + v).classList.add('active');
            document.querySelectorAll('.btn-nav').forEach(b => {
                b.classList.remove('active');
                b.querySelector('span').classList.remove('text-white');
            });
            document.getElementById('nav-' + v).classList.add('active');
            document.getElementById('nav-' + v).querySelector('span').classList.add('text-white');
            if (v !== 'dashboard') renderData();
            lucide.createIcons();
        }

        function updateUI(id) {
            const f = document.getElementById(id + '_file').files[0];
            if (f) document.getElementById(id + '_txt').innerText = "✓ " + f.name;
        }

        saveToStorage();
        window.onload = renderData;

        {% if result %}
        const ctx = document.getElementById('mainChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Synced', 'Gaps', 'Meta'],
                datasets: [{
                    data: {{ result.visual | tojson }},
            backgroundColor: ['#6366f1', '#f472b6', '#3b82f6'],
            borderWidth: 0, cutout: '82%'
        }]
            },
            options: { plugins: { legend: { display: false } }, maintainAspectRatio: false }
        });
        {% endif %}
    </script>
</body>

</html>