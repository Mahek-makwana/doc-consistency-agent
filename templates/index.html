<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CraftAI DocSync | Enterprise Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #050505;
            color: #fff;
            margin: 0;
            overflow: hidden;
        }

        .flex-h-screen {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 288px;
            background: #050505;
            border-right: 1px solid rgba(168, 85, 247, 0.15);
            display: flex;
            flex-direction: column;
        }

        .main-container {
            flex: 1;
            overflow-y: auto;
            position: relative;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 24px;
            transition: 0.3s;
        }

        .glass-card:hover {
            border-color: rgba(168, 85, 247, 0.3);
            background: rgba(255, 255, 255, 0.05);
        }

        .btn-nav {
            cursor: pointer;
            transition: 0.3s;
            color: #666;
        }

        .btn-nav.active {
            background: linear-gradient(to right, #6366f1, #a855f7);
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        .view-section {
            display: none;
        }

        .view-section.active {
            display: block;
        }

        .btn-gradient {
            background: linear-gradient(to right, #6366f1, #a855f7);
            cursor: pointer;
        }
    </style>
</head>

<body>

    <div class="flex-h-screen">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="p-8 border-b border-white/5">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center"><i
                            data-lucide="sparkles" class="w-6 h-6 text-white"></i></div>
                    <div>
                        <h1 class="font-bold text-sm uppercase tracking-tighter">CraftAI</h1>
                        <p class="text-[8px] text-indigo-400 font-black uppercase">DocSync Agent</p>
                    </div>
                </div>
            </div>
            <nav class="flex-1 p-6 space-y-2">
                <div id="nav-dashboard" onclick="showView('dashboard')"
                    class="btn-nav active flex items-center gap-4 px-5 py-4 rounded-xl"><i
                        data-lucide="layout-dashboard" class="w-5 h-5"></i><span
                        class="font-bold text-sm">Dashboard</span></div>
                <div id="nav-reports" onclick="showView('reports')"
                    class="btn-nav flex items-center gap-4 px-5 py-4 rounded-xl"><i data-lucide="file-text"
                        class="w-5 h-5"></i><span class="font-bold text-sm">Reports</span></div>
                <div id="nav-history" onclick="showView('history')"
                    class="btn-nav flex items-center gap-4 px-5 py-4 rounded-xl"><i data-lucide="clock"
                        class="w-5 h-5"></i><span class="font-bold text-sm">History</span></div>
            </nav>
        </div>

        <!-- CONTENT -->
        <div class="main-container">
            <!-- DASHBOARD -->
            <div id="view-dashboard" class="view-section active p-12">
                <h1 class="text-6xl font-black mb-8 tracking-tighter">Project <span
                        class="text-indigo-400">Analysis</span></h1>

                <form action="/analyze" method="POST" enctype="multipart/form-data" class="mb-12">
                    <div class="grid grid-cols-2 gap-6 mb-8">
                        <div class="p-8 border-2 border-dashed border-white/10 rounded-2xl text-center bg-white/5 cursor-pointer hover:border-indigo-500"
                            onclick="document.getElementById('code_file').click()">
                            <i data-lucide="upload-cloud" class="w-8 h-8 mx-auto mb-2 text-indigo-400"></i>
                            <h3 class="text-xs font-black uppercase">1. Project Scenario</h3>
                            <p id="code_txt" class="text-[10px] text-gray-500 font-bold">Upload Source Code</p>
                            <input type="file" id="code_file" name="code_file" class="hidden"
                                onchange="updateUI('code')">
                        </div>
                        <div class="p-8 border-2 border-dashed border-white/10 rounded-2xl text-center bg-white/5 cursor-pointer hover:border-purple-500"
                            onclick="document.getElementById('doc_file').click()">
                            <i data-lucide="file-plus" class="w-8 h-8 mx-auto mb-2 text-purple-400"></i>
                            <h3 class="text-xs font-black uppercase">2. Documentation</h3>
                            <p id="doc_txt" class="text-[10px] text-gray-500 font-bold">Upload README/MD</p>
                            <input type="file" id="doc_file" name="doc_file" class="hidden" onchange="updateUI('doc')">
                        </div>
                    </div>
                    <button type="submit" class="btn-gradient px-12 py-5 rounded-2xl font-black text-sm">INITIATE
                        CONSISTENCY AUDIT</button>
                </form>

                {% if result %}
                <div class="grid grid-cols-4 gap-6">
                    <div class="glass-card">
                        <h3 class="text-[10px] font-black uppercase text-gray-500 mb-4">Analysis Summary</h3>
                        <p class="text-4xl font-black text-white">{{ result.score }}%</p>
                        <p class="text-[10px] text-indigo-400 font-bold uppercase tracking-widest">{{ result.label }}
                        </p>
                    </div>
                    <div class="glass-card">
                        <h3 class="text-[10px] font-black uppercase text-gray-500 mb-4">Statistic Report</h3>
                        <div class="flex justify-between"><span class="text-[10px] font-black">Total Issues</span><span
                                class="text-xl font-black text-red-500">{{ result.stats.total_issues }}</span></div>
                        <div class="flex justify-between"><span class="text-[10px] font-black">Synced</span><span
                                class="text-xl font-black text-green-500">{{ result.stats.synced_terms }}</span></div>
                    </div>
                    <div class="glass-card">
                        <h3 class="text-[10px] font-black uppercase text-gray-500 mb-4">Issue Summary</h3>
                        <p class="text-[9px] text-gray-400 leading-relaxed mb-4">{{ result.summary }}</p>
                        <div class="h-1 bg-white/5 rounded-full">
                            <div class="h-full bg-red-500/50" style="width: {{ result.stats.breakdown.Terminology }}%">
                            </div>
                        </div>
                    </div>
                    <div class="glass-card">
                        <h3 class="text-[10px] font-black uppercase text-gray-500 mb-2">Visual Summary</h3>
                        <div class="h-24"><canvas id="mainChart"></canvas></div>
                        <div class="mt-4 flex gap-4 text-[8px] font-black uppercase justify-center">
                            <span class="text-indigo-400">● Synced</span>
                            <span class="text-pink-400">● Gaps</span>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- REPORTS -->
            <div id="view-reports" class="view-section p-12">
                <h1 class="text-6xl font-black mb-8">Detailed <span class="text-purple-400">Reports</span></h1>
                <div class="glass-card p-12 overflow-hidden">
                    <table class="w-full text-left">
                        <thead class="text-[10px] font-black uppercase text-gray-500 border-b border-white/5">
                            <tr>
                                <th class="pb-6">Project Name</th>
                                <th class="pb-6">Score</th>
                                <th class="pb-6">Status</th>
                                <th class="pb-6">Action</th>
                            </tr>
                        </thead>
                        <tbody id="report-body" class="text-sm"></tbody>
                    </table>
                </div>
            </div>

            <!-- HISTORY -->
            <div id="view-history" class="view-section p-12">
                <h1 class="text-6xl font-black mb-8">Audit <span class="text-indigo-400">History</span></h1>
                <div id="history-container" class="space-y-4"></div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        function downloadPDF(project, score, status) {
            const content = `CRAFT AI AUDIT REPORT\nProject: ${project}\nScore: ${score}%\nStatus: ${status}\nGenerated on: ${new Date().toLocaleString()}`;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Audit_Report_${project}.txt`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function renderAll() {
            const h = JSON.parse(localStorage.getItem('audits') || '[]');
            const historyList = document.getElementById('history-container');
            const reportTable = document.getElementById('report-body');

            if (historyList) {
                historyList.innerHTML = h.map(e => `
                    <div class="glass-card flex justify-between items-center p-8 border-l-4 border-indigo-500">
                        <div><h3 class="text-xl font-black uppercase">${e.project}</h3><p class="text-[10px] text-gray-500 font-bold uppercase tracking-widest">${e.time}</p></div>
                        <div class="text-right"><p class="text-3xl font-black text-indigo-400">${e.score}%</p><p class="text-[9px] text-gray-500 font-black uppercase">Accurate Consistency</p></div>
                    </div>
                `).join('');
            }

            if (reportTable) {
                reportTable.innerHTML = h.map(e => `
                    <tr class="border-b border-white/5">
                        <td class="py-6 font-bold text-gray-300 uppercase">${e.project}</td>
                        <td class="py-6 font-black text-indigo-400">${e.score}%</td>
                        <td class="py-6 text-[10px] uppercase font-black text-gray-500">${e.status}</td>
                        <td class="py-6"><button onclick="downloadPDF('${e.project}', '${e.score}', '${e.status}')" class="text-indigo-400 font-black hover:underline uppercase text-[10px]">Download Report</button></td>
                    </tr>
                `).join('');
            }
        }

        function showView(v) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.getElementById('view-' + v).classList.add('active');
            document.querySelectorAll('.btn-nav').forEach(b => b.classList.remove('active'));
            document.getElementById('nav-' + v).classList.add('active');
            if (v !== 'dashboard') renderAll();
            lucide.createIcons();
        }

        function updateUI(id) {
            const f = document.getElementById(id + '_file').files[0];
            if (f) document.getElementById(id + '_txt').innerText = f.name;
        }

        {% if result %}
        const data = {
            project: "{{ result.file_list[0] if result.file_list else 'Audit' }}",
            score: {{ result.score }},
        status: "{{ result.label }}",
            time: new Date().toLocaleString()
        };
        let h = JSON.parse(localStorage.getItem('audits') || '[]');
        h.unshift(data);
        localStorage.setItem('audits', JSON.stringify(h.slice(0, 10)));

        const ctx = document.getElementById('mainChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Synced', 'Gaps', 'Meta'],
                datasets: [{
                    data: {{ result.visual | tojson }},
            backgroundColor: ['#6366f1', '#f472b6', '#3b82f6'],
            borderWidth: 0, cutout: '85%'
        }]
            },
            options: { plugins: { legend: { display: false } }, maintainAspectRatio: false }
        });
        {% endif %}

        window.onload = renderAll;
    </script>
</body>

</html>